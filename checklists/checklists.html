<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AW139 Checklists</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="checklists.css">
</head>

<body>
  <div id="app" class="checklist-container">
    <!-- MENU PAGE -->
    <div v-if="currentPage === 'menu'" class="card">
      <div id="menuHeader" class="page-header">
        <a class="btn btn-back" href="../index.html">‚Üê Back to Home</a>
        <h2>Checklists</h2>
      </div>
      <template v-for="(checklist, id) in checklists" :key="id">
        <div class="checklist-menu-item" :class="{ complete: isChecklistComplete(id) }" @click="openChecklist(id)">
          <div class="menu-item-title">
            <span v-if="isChecklistComplete(id)">‚úì</span>
            <span v-else>‚óã</span>
            <span>{{ checklist.title }}</span>
          </div>
          <div class="menu-item-progress">
            {{ getChecklistProgress(id).completed }} of {{ getChecklistProgress(id).total }} completed
          </div>
        </div>
      </template>
    </div>

    <!-- POWER SOURCE SELECTION MODAL (NEW) -->
    <div v-if="currentPage === 'power-select'" class="modal-overlay">
      <div class="modal-box">
        <h2>Select Power Source</h2>
        <p style="margin-bottom: 24px;">Choose your starting power source for the Normal Engine Start checklist:</p>
        <div class="power-select-buttons">
          <button class="power-select-btn" @click="selectPowerSource('battery')">
            <div class="power-icon">üîã</div>
            <div class="power-label">Battery Start</div>
            <div class="power-desc">Essential checks only</div>
          </button>
          <button class="power-select-btn" @click="selectPowerSource('external')">
            <div class="power-icon">‚ö°</div>
            <div class="power-label">External Power</div>
            <div class="power-desc">Complete checks</div>
          </button>
        </div>
        <button class="modal-cancel" @click="backToMenu()">Cancel</button>
      </div>
    </div>

    <!-- CHECKLIST VIEW PAGE -->
    <div v-if="currentPage === 'view' && currentChecklistData">
      <div class="checklist-header">
        <div class="button-group">
          <button class="btn btn-back" @click="backToMenu()">‚Üê Back</button>
          <button class="btn btn-reset" @click="resetCurrentChecklist()">‚ü≤ Reset</button>
        </div>
        <h2>{{ currentChecklistData.title }}</h2>
        <div class="progress-sub">
          {{ getChecklistProgress(currentChecklistId).completed }} of {{ getChecklistProgress(currentChecklistId).total
          }} completed
        </div>
        <div class="progress-bar">
          <div class="progress-fill" :style="{ width: getProgressPercentage(currentChecklistId) + '%' }"></div>
        </div>
      </div>

      <div v-for="(item, index) in getFilteredItems()" :key="index">
        <div v-if="item.type === 'check'" class="checklist-item" :class="{ checked: isItemChecked(index) }"
          @click="toggleItem(index)" :data-item="index">
          <div class="check-circle"><span class="check-mark">‚úì</span></div>
          <div class="item-number">{{ getCheckNumber(index) }}</div>
          <div class="item-content">
            <div class="item-text">{{ item.text }}</div>
            <div class="item-action" v-html="item.action"></div>
          </div>
          <div v-if="inlineNotice && inlineNotice.index===index" class="inline-toast">{{ inlineNotice.text }}</div>
        </div>

        <div v-else-if="item.type === 'header'" class="header-box">{{ item.text }}</div>
        <div v-else-if="item.type==='caution'" class="caution-box">
          <div class="alert-label-row">‚ö†Ô∏è <strong>CAUTION</strong> ‚ö†Ô∏è</div>
          <div class="alert-body">{{ getAfterColon(item.text) }}</div>
        </div>
        <div v-else-if="item.type==='warning'" class="warning-box">
          <div class="alert-label-row">‚ÄºÔ∏è <strong>WARNING</strong> ‚ÄºÔ∏è</div>
          <div class="alert-body">{{ getAfterColon(item.text) }}</div>
        </div>
        <div v-else-if="item.type === 'intro-image'" class="intro-image-box">
          <img :src="item.src" :alt="item.caption" class="intro-image" />
          <p class="intro-caption">{{ item.caption }}</p>
        </div>
        <div v-else-if="item.type === 'note'" class="note-box">
          <div class="note-icon">üõà</div>
          <div class="note-text"><strong>Note: </strong><span v-html="item.text"></span></div>
        </div>
        <div v-else-if="item.type === 'subcheck'" class="subcheck-item">
          <input type="checkbox" />
          <span>{{ item.text }}</span>
        </div>
        <div v-else-if="item.type === 'info'" class="info-box">
          <div class="note-icon">‚ÑπÔ∏è</div>
          <div class="note-text"><span v-html="item.text"></span></div>
        </div>

      </div>

      <div v-if="isChecklistComplete(currentChecklistId)" class="completion-badge">‚úì Checklist Complete</div>
    </div>
  </div>

  <script src="https://unpkg.com/vue@3"></script>
  <script src="../app.js"></script>
  <script src="checklists.js"></script>
</body>

</html>